<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="左手栏有目录。 出现的宏： 12345#define rep(i, l, r) for(int i &#x3D; (l); i &lt;&#x3D; (r); i++)#define per(i, r, l) for(int i &#x3D; (r); i &gt;&#x3D; (l); i--)#define mem(a, b) memset(a, b, sizeof a)#define For(i, l, r) for(int i">
<meta property="og:type" content="article">
<meta property="og:title" content="模板（持续更新）">
<meta property="og:url" content="http://example.com/template/index.html">
<meta property="og:site_name" content="platelet&#39;s blog">
<meta property="og:description" content="左手栏有目录。 出现的宏： 12345#define rep(i, l, r) for(int i &#x3D; (l); i &lt;&#x3D; (r); i++)#define per(i, r, l) for(int i &#x3D; (r); i &gt;&#x3D; (l); i--)#define mem(a, b) memset(a, b, sizeof a)#define For(i, l, r) for(int i">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-04-16T08:45:41.000Z">
<meta property="article:modified_time" content="2023-08-03T04:27:40.892Z">
<meta property="article:author" content="platelet">
<meta property="article:tag" content="模板">
<meta property="article:tag" content="持续更新">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/template/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/template/","path":"template/","title":"模板（持续更新）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>模板（持续更新） | platelet's blog</title><meta name="robots" content="noindex">
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">platelet's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">精于心，简于形</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-template"><a href="/template/" rel="section"><i class="fa fa-code fa-fw"></i>模板</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%89%E7%94%A8%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.</span> <span class="nav-text">有用的模板</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#fast-io-%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B4%E6%95%B0%E7%89%88"><span class="nav-number">1.1.</span> <span class="nav-text">Fast IO 有符号整数版</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#atcoder-modint"><span class="nav-number">1.2.</span> <span class="nav-text">AtCoder-modint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E6%A8%A1%E6%95%B0%E5%8F%96%E6%A8%A1"><span class="nav-number">1.3.</span> <span class="nav-text">大模数取模</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bash-%E5%AF%B9%E6%8B%8D"><span class="nav-number">1.4.</span> <span class="nav-text">bash 对拍</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6"><span class="nav-number">2.</span> <span class="nav-text">数学</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ntt"><span class="nav-number">2.1.</span> <span class="nav-text">NTT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%BB%E6%84%8F%E6%A8%A1%E6%95%B0-ntt-mtt"><span class="nav-number">2.2.</span> <span class="nav-text">任意模数 NTT &#x2F; MTT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E6%B1%82%E9%80%86-polyinv"><span class="nav-number">2.3.</span> <span class="nav-text">多项式求逆 &#x2F; polyInv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E7%84%B6%E6%95%B0%E7%AD%89%E5%B9%82%E6%B1%82%E5%92%8C"><span class="nav-number">2.4.</span> <span class="nav-text">自然数等幂求和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86"><span class="nav-number">2.5.</span> <span class="nav-text">中国剩余定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86-excrt"><span class="nav-number">2.6.</span> <span class="nav-text">扩展中国剩余定理 &#x2F; exCRT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%9C%E6%95%99%E7%AD%9B"><span class="nav-number">2.7.</span> <span class="nav-text">杜教筛</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#min-25-%E7%AD%9B-min25"><span class="nav-number">2.8.</span> <span class="nav-text">Min-25 筛 &#x2F; min25</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">2.8.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">2.8.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exbsgs"><span class="nav-number">2.9.</span> <span class="nav-text">exBSGS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="nav-number">2.9.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-1"><span class="nav-number">2.9.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cipolla"><span class="nav-number">2.10.</span> <span class="nav-text">cipolla</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="nav-number">2.10.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-2"><span class="nav-number">2.10.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#miller-rabin-pollard-rho"><span class="nav-number">2.11.</span> <span class="nav-text">Miller Rabin &amp; Pollard Rho</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="nav-number">2.11.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-3"><span class="nav-number">2.11.2.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%A0%91-lct"><span class="nav-number">3.1.</span> <span class="nav-text">动态树 &#x2F; LCT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E7%89%88"><span class="nav-number">3.1.1.</span> <span class="nav-text">普通版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-4"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%B4%E6%8A%A4%E5%AD%90%E6%A0%91-size-%E7%89%88"><span class="nav-number">3.1.2.</span> <span class="nav-text">维护子树 size 版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-5"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-5"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pbdstree"><span class="nav-number">3.2.</span> <span class="nav-text">pbds::tree</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-6"><span class="nav-number">3.2.0.1.</span> <span class="nav-text">定义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rbst"><span class="nav-number">3.3.</span> <span class="nav-text">RBST</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E7%89%88-1"><span class="nav-number">3.3.1.</span> <span class="nav-text">普通版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-7"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-6"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%89%88"><span class="nav-number">3.3.2.</span> <span class="nav-text">可持久化版</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#k-d-%E6%A0%91"><span class="nav-number">3.4.</span> <span class="nav-text">K-D 树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-8"><span class="nav-number">3.4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-7"><span class="nav-number">3.4.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%E5%B9%B3%E6%96%B9"><span class="nav-number">3.4.3.</span> <span class="nav-text">欧几里得距离平方</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%BC%E5%93%88%E9%A1%BF%E8%B7%9D%E7%A6%BB"><span class="nav-number">3.4.4.</span> <span class="nav-text">曼哈顿距离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E8%B7%9D%E7%A6%BB"><span class="nav-number">3.4.5.</span> <span class="nav-text">切比雪夫距离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E8%BF%91%E7%82%B9%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.6.</span> <span class="nav-text">最近点查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-9"><span class="nav-number">3.4.6.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-8"><span class="nav-number">3.4.6.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">3.4.6.3.</span> <span class="nav-text">初始化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E8%BF%9C%E7%82%B9%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.7.</span> <span class="nav-text">最远点查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-10"><span class="nav-number">3.4.7.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-9"><span class="nav-number">3.4.7.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-1"><span class="nav-number">3.4.7.3.</span> <span class="nav-text">初始化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A9%E5%BD%A2%E5%88%A4%E5%AE%9A"><span class="nav-number">3.4.8.</span> <span class="nav-text">矩形判定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A9%E5%BD%A2%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E6%89%80%E6%9C%89%E7%82%B9"><span class="nav-number">3.4.8.1.</span> <span class="nav-text">矩形是否包含所有点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A9%E5%BD%A2%E6%98%AF%E5%90%A6%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E7%82%B9"><span class="nav-number">3.4.8.2.</span> <span class="nav-text">矩形是否可能包含点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%86%E5%88%A4%E5%AE%9A"><span class="nav-number">3.4.9.</span> <span class="nav-text">圆判定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%86%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E6%89%80%E6%9C%89%E7%82%B9"><span class="nav-number">3.4.9.1.</span> <span class="nav-text">圆是否包含所有点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%86%E6%98%AF%E5%90%A6%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E7%82%B9"><span class="nav-number">3.4.9.2.</span> <span class="nav-text">圆是否可能包含点</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E8%AE%BA%E5%92%8C%E6%A0%91"><span class="nav-number">4.</span> <span class="nav-text">图论和树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%A0%91-vtree"><span class="nav-number">4.1.</span> <span class="nav-text">虚树 &#x2F; vtree</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vector-%E7%89%88"><span class="nav-number">4.1.1.</span> <span class="nav-text">vector 版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-11"><span class="nav-number">4.1.1.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-10"><span class="nav-number">4.1.1.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E5%BE%88%E5%A4%9A%E7%89%88"><span class="nav-number">4.1.2.</span> <span class="nav-text">快很多版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-12"><span class="nav-number">4.1.2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-11"><span class="nav-number">4.1.2.2.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%A4%A7%E6%B5%81-mf"><span class="nav-number">4.2.</span> <span class="nav-text">最大流 &#x2F; mf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-13"><span class="nav-number">4.2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-12"><span class="nav-number">4.2.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81-mcf"><span class="nav-number">4.3.</span> <span class="nav-text">最小费用最大流 &#x2F; mcf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8B%E5%AF%B9%E5%81%B6%E7%AE%97%E6%B3%95%E5%8D%95%E8%B7%AF%E5%A2%9E%E5%B9%BF"><span class="nav-number">4.3.1.</span> <span class="nav-text">原始对偶算法（单路增广）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-14"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-13"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8B%E5%AF%B9%E5%81%B6%E7%AE%97%E6%B3%95%E5%A4%9A%E8%B7%AF%E5%A2%9E%E5%B9%BF"><span class="nav-number">4.3.2.</span> <span class="nav-text">原始对偶算法（多路增广）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-15"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-14"><span class="nav-number">4.3.2.2.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D-match"><span class="nav-number">4.4.</span> <span class="nav-text">二分图最大匹配 &#x2F; match</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-16"><span class="nav-number">4.4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-15"><span class="nav-number">4.4.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">4.4.3.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sat-%E9%97%AE%E9%A2%98"><span class="nav-number">4.5.</span> <span class="nav-text">2-SAT 问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-17"><span class="nav-number">4.5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-16"><span class="nav-number">4.5.2.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">5.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#manacher-%E6%B1%82%E5%81%B6%E5%9B%9E%E6%96%87%E4%B8%B2"><span class="nav-number">5.1.</span> <span class="nav-text">manacher 求偶回文串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9E%E6%96%87%E8%87%AA%E5%8A%A8%E6%9C%BA-pam"><span class="nav-number">5.2.</span> <span class="nav-text">回文自动机 PAM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E7%89%88-2"><span class="nav-number">5.2.1.</span> <span class="nav-text">普通版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-18"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-17"><span class="nav-number">5.2.1.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-number">5.2.1.3.</span> <span class="nav-text">预处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%B6%E5%9B%9E%E6%96%87%E7%89%88"><span class="nav-number">5.2.2.</span> <span class="nav-text">偶回文版</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-18"><span class="nav-number">5.2.2.1.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E5%A4%84%E7%90%86-1"><span class="nav-number">5.2.2.2.</span> <span class="nav-text">预处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84-sa"><span class="nav-number">5.3.</span> <span class="nav-text">后缀数组 &#x2F; SA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-19"><span class="nav-number">5.3.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-19"><span class="nav-number">5.3.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA-sam"><span class="nav-number">5.4.</span> <span class="nav-text">后缀自动机 &#x2F; SAM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-20"><span class="nav-number">5.4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-20"><span class="nav-number">5.4.2.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E8%A1%A8%E7%A4%BA%E6%B3%95-smallest-cyclic-shift"><span class="nav-number">5.5.</span> <span class="nav-text">最小表示法 &#x2F; smallest cyclic shift</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-21"><span class="nav-number">5.5.1.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E5%90%8E%E7%BC%80-smallest-suffix"><span class="nav-number">5.6.</span> <span class="nav-text">最小后缀 &#x2F; smallest suffix</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-22"><span class="nav-number">5.6.1.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="platelet"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">platelet</p>
  <div class="site-description" itemprop="description">天地不仁<br>platelet.top</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/template/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="platelet">
      <meta itemprop="description" content="天地不仁<br>platelet.top">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="platelet's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          模板（持续更新）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-16 16:45:41" itemprop="dateCreated datePublished" datetime="2021-04-16T16:45:41+08:00">2021-04-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-03 12:27:40" itemprop="dateModified" datetime="2023-08-03T12:27:40+08:00">2023-08-03</time>
      </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>38k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>35 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>左手栏有目录。</strong></p>
<p>出现的宏：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &lt;= (r); i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> per(i, r, l) for(int i = (r); i &gt;= (l); i--)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mem(a, b) memset(a, b, sizeof a)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> For(i, l, r) for(int i = (l), i##e = (r); i &lt; i##e; i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br></pre></td></tr></table></figure>
<h1 id="有用的模板">有用的模板</h1>
<h2 id="fast-io-有符号整数版">Fast IO 有符号整数版</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">IO</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> inSZ = <span class="number">1</span> &lt;&lt; <span class="number">17</span>;</span><br><span class="line">    <span class="type">char</span> inBuf[inSZ], *in1, *in2;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">inline</span> __attribute((always_inline))</span><br><span class="line">    <span class="function">T <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (in1 &gt; inBuf + inSZ - <span class="number">32</span>) [[unlikely]] &#123;</span><br><span class="line">            <span class="keyword">auto</span> len = in2 - in1;</span><br><span class="line">            <span class="built_in">memcpy</span>(inBuf, in1, len);</span><br><span class="line">            in1 = inBuf, in2 = inBuf + len;</span><br><span class="line">            in2 += <span class="built_in">fread</span>(in2, <span class="number">1</span>, inSZ - len, stdin);</span><br><span class="line">            <span class="keyword">if</span> (in2 != inBuf + inSZ) *in2 = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        T res = <span class="number">0</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> c;</span><br><span class="line">        <span class="type">bool</span> neg = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((c = *in1++) &lt; <span class="number">48</span>) neg = c == <span class="number">45</span>;</span><br><span class="line">        <span class="keyword">while</span> (res = res * <span class="number">10</span> + (c - <span class="number">48</span>), (c = *in1++) &gt;= <span class="number">48</span>);</span><br><span class="line">        <span class="keyword">return</span> neg ? -res : res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> outSZ = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line">    <span class="type">char</span> outBuf[outSZ], *out;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">inline</span> __attribute((always_inline))</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (out &gt; outBuf + outSZ - <span class="number">32</span>) [[unlikely]]</span><br><span class="line">            <span class="built_in">fwrite</span>(outBuf, <span class="number">1</span>, out - outBuf, stdout), out = outBuf;</span><br><span class="line">        <span class="keyword">if</span> (!x) <span class="keyword">return</span> *out++ = <span class="number">48</span>, <span class="built_in">void</span>();</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) *out++ = <span class="number">45</span>, x = -x;</span><br><span class="line">        <span class="built_in">alignas</span>(<span class="number">2</span>) <span class="type">const</span> <span class="type">char</span>* digits =</span><br><span class="line">        <span class="string">&quot;0001020304050607080910111213141516171819&quot;</span></span><br><span class="line">        <span class="string">&quot;2021222324252627282930313233343536373839&quot;</span></span><br><span class="line">        <span class="string">&quot;4041424344454647484950515253545556575859&quot;</span></span><br><span class="line">        <span class="string">&quot;6061626364656667686970717273747576777879&quot;</span></span><br><span class="line">        <span class="string">&quot;8081828384858687888990919293949596979899&quot;</span>;</span><br><span class="line">        <span class="built_in">alignas</span>(<span class="number">64</span>) <span class="type">static</span> <span class="type">char</span> buf[<span class="number">20</span>];</span><br><span class="line">        <span class="type">char</span>* p = buf + <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">while</span> (x &gt;= <span class="number">10</span>) <span class="built_in">memcpy</span>(p -= <span class="number">2</span>, digits + x % <span class="number">100</span> * <span class="number">2</span>, <span class="number">2</span>), x /= <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">if</span> (x) *--p = <span class="number">48</span> + x;</span><br><span class="line">        <span class="keyword">auto</span> len = buf + <span class="number">20</span> - p;</span><br><span class="line">        <span class="built_in">memcpy</span>(out, p, len), out += len;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">IO</span>() &#123;</span><br><span class="line">        in1 = in2 = inBuf + inSZ;</span><br><span class="line">        out = outBuf;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">IO</span>() &#123; <span class="built_in">fwrite</span>(outBuf, <span class="number">1</span>, out - outBuf, stdout); &#125;</span><br><span class="line">&#125; IO;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T </span>= <span class="type">int</span>&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IO.<span class="built_in">read</span>&lt;T&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Args&gt; <span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(Args&amp;... args)</span> </span>&#123;</span><br><span class="line">    ((args = IO.<span class="built_in">read</span>&lt;Args&gt;()), ...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x, <span class="type">char</span> c = <span class="string">&#x27;\n&#x27;</span>)</span> </span>&#123;</span><br><span class="line">    IO.<span class="built_in">write</span>(x), *IO.out++ = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="atcoder-modint">AtCoder-modint</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">using</span> u32 = <span class="type">uint32_t</span>;</span><br><span class="line"><span class="keyword">using</span> u64 = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> ll <span class="title">safe_mod</span><span class="params">(ll x, ll m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x %= m, x &lt; <span class="number">0</span> ? x + m : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> ll <span class="title">pow_mod_constexpr</span><span class="params">(ll x, ll n, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    u32 _m = m;</span><br><span class="line">    u64 r = <span class="number">1</span>, _x = <span class="built_in">safe_mod</span>(x, m);</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, _x = _x * _x % _m)</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = r * _x % m;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">is_prime_constexpr</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span> || n == <span class="number">7</span> || n == <span class="number">61</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    ll d = n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (~d &amp; <span class="number">1</span>) d &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (ll a : &#123;<span class="number">2</span>, <span class="number">7</span>, <span class="number">61</span>&#125;) &#123;</span><br><span class="line">        ll t = d, y = <span class="built_in">pow_mod_constexpr</span>(a, t, n);</span><br><span class="line">        <span class="keyword">while</span> (t != n - <span class="number">1</span> &amp;&amp; y != <span class="number">1</span> &amp;&amp; y != n - <span class="number">1</span>)</span><br><span class="line">            y = y * y % n, t &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (y != n - <span class="number">1</span> &amp;&amp; t % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> pair&lt;ll, ll&gt; <span class="title">inv_gcd</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    a = <span class="built_in">safe_mod</span>(a, b);</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="number">0</span>) <span class="keyword">return</span> &#123;b, <span class="number">0</span>&#125;;</span><br><span class="line">    ll s = b, t = a, m0 = <span class="number">0</span>, m1 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (t) &#123;</span><br><span class="line">        ll u = s / t;</span><br><span class="line">        s -= t * u, m0 -= m1 * u;</span><br><span class="line">        ll tmp = s;</span><br><span class="line">        s = t, t = tmp, tmp = m0, m0 = m1, m1 = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (m0 &lt; <span class="number">0</span>) m0 += b / s;</span><br><span class="line">    <span class="keyword">return</span> &#123;s, m0&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">barrett</span> &#123;</span><br><span class="line">    u32 m; u64 im;</span><br><span class="line">    <span class="built_in">barrett</span>(u32 m) :<span class="built_in">m</span>(m), <span class="built_in">im</span>(~<span class="number">0ull</span> / m + <span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="function">u32 <span class="title">mul</span><span class="params">(u32 a, u32 b)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        u64 z = (u64)a * b;</span><br><span class="line">        u64 x = (<span class="type">__uint128_t</span>)z * im &gt;&gt; <span class="number">64</span>;</span><br><span class="line">        u32 v = z - x * m;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)v &lt; <span class="number">0</span> ? v + m : v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> m&gt; <span class="keyword">struct</span> <span class="title class_">static_modint</span> &#123;</span><br><span class="line">    <span class="keyword">using</span> mint = static_modint;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> mint <span class="title">raw</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        mint x;</span><br><span class="line">        <span class="keyword">return</span> x._v = v, x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static_modint</span>() : _v(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="title">static_modint</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">        ll x = v % m;</span><br><span class="line">        _v = x &lt; <span class="number">0</span> ? x + m : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">u32 <span class="title">val</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _v; &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>++() &#123;</span><br><span class="line">        <span class="keyword">if</span> (++_v == m) _v = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>--() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_v--) _v = m - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>++(<span class="type">int</span>) &#123;</span><br><span class="line">        mint res = *<span class="keyword">this</span>;</span><br><span class="line">        ++*<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>--(<span class="type">int</span>) &#123;</span><br><span class="line">        mint res = *<span class="keyword">this</span>;</span><br><span class="line">        --*<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        _v += rhs._v;</span><br><span class="line">        <span class="keyword">if</span> (_v &gt;= m) _v -= m;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        _v -= rhs._v;</span><br><span class="line">        <span class="keyword">if</span> (_v &gt;= m) _v += m;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        u64 z = _v;</span><br><span class="line">        z *= rhs._v, _v = z % m;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>/=(<span class="type">const</span> mint&amp; rhs) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> * rhs.<span class="built_in">inv</span>(); &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>+() <span class="type">const</span> &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>-() <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">mint</span>() - *<span class="keyword">this</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">mint <span class="title">pow</span><span class="params">(ll n)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="number">0</span> &lt;= n);</span><br><span class="line">        mint x = *<span class="keyword">this</span>, r = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, x *= x) <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r *= x;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">mint <span class="title">inv</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (prime) &#123;</span><br><span class="line">            <span class="built_in">assert</span>(_v);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">pow</span>(m - <span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">auto</span> eg = <span class="built_in">inv_gcd</span>(_v, m);</span><br><span class="line">            <span class="built_in">assert</span>(eg.first == <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> eg.second;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>+(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) += rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>-(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) -= rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>*(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) *= rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>/(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) /= rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs._v == rhs._v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs._v != rhs._v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    u32 _v;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> prime = <span class="built_in">is_prime_constexpr</span>(m);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> id&gt; <span class="keyword">struct</span> <span class="title class_">dynamic_modint</span> &#123;</span><br><span class="line">    <span class="keyword">using</span> mint = dynamic_modint;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">mod</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> bt.m; &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">set_mod</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="number">1</span> &lt;= m), bt = <span class="built_in">barrett</span>(m);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> mint <span class="title">raw</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        mint x;</span><br><span class="line">        <span class="keyword">return</span> x._v = v, x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dynamic_modint</span>() : _v(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="title">dynamic_modint</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">        ll x = v % (<span class="type">int</span>)bt.m;</span><br><span class="line">        _v = x &lt; <span class="number">0</span> ? x + bt.m : x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">u32 <span class="title">val</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _v; &#125;</span><br><span class="line"></span><br><span class="line">    mint&amp; <span class="keyword">operator</span>++() &#123;</span><br><span class="line">        <span class="keyword">if</span> (++_v == bt.m) _v = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>--() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_v--) _v = bt.m - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>++(<span class="type">int</span>) &#123;</span><br><span class="line">        mint res = *<span class="keyword">this</span>;</span><br><span class="line">        ++*<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>--(<span class="type">int</span>) &#123;</span><br><span class="line">        mint res = *<span class="keyword">this</span>;</span><br><span class="line">        --*<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mint&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        _v += rhs._v;</span><br><span class="line">        <span class="keyword">if</span> (_v &gt;= bt.m) _v -= bt.m;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        _v += bt.m - rhs._v;</span><br><span class="line">        <span class="keyword">if</span> (_v &gt;= bt.m) _v -= bt.m;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        _v = bt.<span class="built_in">mul</span>(_v, rhs._v);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mint&amp; <span class="keyword">operator</span>/=(<span class="type">const</span> mint&amp; rhs) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> = *<span class="keyword">this</span> * rhs.<span class="built_in">inv</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    mint <span class="keyword">operator</span>+() <span class="type">const</span> &#123; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    mint <span class="keyword">operator</span>-() <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">mint</span>() - *<span class="keyword">this</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">mint <span class="title">pow</span><span class="params">(ll n)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="number">0</span> &lt;= n);</span><br><span class="line">        mint x = *<span class="keyword">this</span>, r = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, x *= x) <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r *= x;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">mint <span class="title">inv</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> eg = <span class="built_in">inv_gcd</span>(_v, bt.m);</span><br><span class="line">        <span class="built_in">assert</span>(eg.first == <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> eg.second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>+(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) += rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>-(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) -= rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>*(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) *= rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> mint <span class="keyword">operator</span>/(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mint</span>(lhs) /= rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs._v == rhs._v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> mint&amp; lhs, <span class="type">const</span> mint&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs._v != rhs._v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    u32 _v;</span><br><span class="line">    <span class="type">static</span> barrett bt;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> id&gt; barrett dynamic_modint&lt;id&gt;::bt = <span class="number">998244353</span>;</span><br></pre></td></tr></table></figure>
<h2 id="大模数取模">大模数取模</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll A, ll B, ll P)</span> </span>&#123;</span><br><span class="line">     C = A * B - (ll)((<span class="type">long</span> <span class="type">double</span>)A * B / P + <span class="number">0.5</span>) * P;</span><br><span class="line">    <span class="keyword">return</span> C &lt; <span class="number">0</span> ? C + P : C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bash-对拍"><code>bash</code> 对拍</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    ./gen &gt; <span class="keyword">in</span></span><br><span class="line">    ./a &lt; <span class="keyword">in</span> &gt; 1</span><br><span class="line">    ./b &lt; <span class="keyword">in</span> &gt; 2</span><br><span class="line">    diff 1 2</span><br><span class="line">    <span class="keyword">if</span> (($? != 0)); <span class="keyword">then</span> <span class="built_in">break</span>; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h1 id="数学">数学</h1>
<h2 id="ntt">NTT</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> (a += b) &lt; P ? a : a - P; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> (a -= b) &lt; <span class="number">0</span> ? a + P : a; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> (<span class="type">uint64_t</span>)(<span class="type">uint32_t</span>)a * (<span class="type">uint32_t</span>)b % P; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ceil2</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Pow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> r = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a))</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = <span class="built_in">mul</span>(r, a);</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">precalc</span> &#123;</span><br><span class="line">    <span class="type">int</span> w[<span class="number">23</span>], iw[<span class="number">23</span>];</span><br><span class="line">    <span class="built_in">precalc</span>() &#123;</span><br><span class="line">        <span class="type">int</span> e[<span class="number">22</span>], ie[<span class="number">22</span>], now = <span class="number">15311432</span>, inow = <span class="number">469870224</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">21</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            e[i] = now, ie[i] = inow;</span><br><span class="line">            now = <span class="built_in">mul</span>(now, now), inow = <span class="built_in">mul</span>(inow, inow);</span><br><span class="line">        &#125;</span><br><span class="line">        now = inow = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">21</span>; i++) &#123;</span><br><span class="line">            w[i] = <span class="built_in">mul</span>(e[i], now), iw[i] = <span class="built_in">mul</span>(ie[i], inow);</span><br><span class="line">            now = <span class="built_in">mul</span>(now, ie[i]), inow = <span class="built_in">mul</span>(inow, e[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; pre;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DIF</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n &gt;&gt; <span class="number">1</span>, l = <span class="number">1</span>; i; i &gt;&gt;= <span class="number">1</span>, l &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x = a[k], y = <span class="built_in">mul</span>(a[k + i], now);</span><br><span class="line">                a[k] = <span class="built_in">add</span>(x, y), a[k + i] = <span class="built_in">sub</span>(x, y);</span><br><span class="line">            &#125;</span><br><span class="line">            now = <span class="built_in">mul</span>(now, pre.w[__builtin_ctz(j + <span class="number">1</span>)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">IDIF</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, l = n &gt;&gt; <span class="number">1</span>; l; i &lt;&lt;= <span class="number">1</span>, l &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x = a[k], y = a[k + i];</span><br><span class="line">                a[k] = <span class="built_in">add</span>(x, y), a[k + i] = <span class="built_in">mul</span>(x - y + P, now);</span><br><span class="line">            &#125;</span><br><span class="line">            now = <span class="built_in">mul</span>(now, pre.iw[__builtin_ctz(j + <span class="number">1</span>)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> inv = <span class="built_in">Pow</span>(n, P - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] = <span class="built_in">mul</span>(a[i], inv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>modint</code> 版</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> mint = static_modint&lt;<span class="number">998244353</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ceil2</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n); &#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">precalc</span> &#123;</span><br><span class="line">    mint w[<span class="number">23</span>], iw[<span class="number">23</span>];</span><br><span class="line">    <span class="built_in">precalc</span>() &#123;</span><br><span class="line">        mint e[<span class="number">22</span>], ie[<span class="number">22</span>], now = <span class="number">15311432</span>, inow = <span class="number">469870224</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">21</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            e[i] = now, ie[i] = inow;</span><br><span class="line">            now *= now, inow *= inow;</span><br><span class="line">        &#125;</span><br><span class="line">        now = inow = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">21</span>; i++) &#123;</span><br><span class="line">            w[i] = e[i] * now, iw[i] = ie[i] * inow;</span><br><span class="line">            now *= ie[i], inow *= e[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; pre;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DIF</span><span class="params">(mint a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n &gt;&gt; <span class="number">1</span>, l = <span class="number">1</span>; i; i &gt;&gt;= <span class="number">1</span>, l &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        mint now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                mint x = a[k], y = a[k + i] * now;</span><br><span class="line">                a[k] = x + y, a[k + i] = x - y;</span><br><span class="line">            &#125;</span><br><span class="line">            now *= pre.w[__builtin_ctz(j + <span class="number">1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">IDIF</span><span class="params">(mint a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, l = n &gt;&gt; <span class="number">1</span>; l; i &lt;&lt;= <span class="number">1</span>, l &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        mint now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                mint x = a[k], y = a[k + i];</span><br><span class="line">                a[k] = x + y, a[k + i] = (x - y) * now;</span><br><span class="line">            &#125;</span><br><span class="line">            now *= pre.iw[__builtin_ctz(j + <span class="number">1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mint inv = <span class="built_in">mint</span>(n).<span class="built_in">inv</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] *= inv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="任意模数-ntt-mtt">任意模数 NTT / MTT</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> cplx = complex&lt;<span class="type">double</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rev[N];</span><br><span class="line">cplx w[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FFT</span><span class="params">(cplx a[], <span class="type">int</span> n, <span class="type">bool</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i]) <span class="built_in">swap</span>(a[i], a[rev[i]]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j += i &lt;&lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + i; k++) &#123;</span><br><span class="line">                cplx x = a[k], y = a[k + i] * w[i + k - j];</span><br><span class="line">                a[k] = x + y, a[k + i] = x - y;</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">if</span> (t) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">reverse</span>(a + <span class="number">1</span>, a + n);</span><br><span class="line">    <span class="type">double</span> inv = <span class="number">1.0</span> / n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] *= inv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FFT2</span><span class="params">(cplx a[], cplx b[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] += b[i] * <span class="number">1</span>i;</span><br><span class="line">    <span class="built_in">FFT</span>(a, n, <span class="number">1</span>);</span><br><span class="line">    b[<span class="number">0</span>] = <span class="built_in">conj</span>(a[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) b[i] = <span class="built_in">conj</span>(a[n - i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cplx x = a[i], y = b[i];</span><br><span class="line">        a[i] = (y + x) * <span class="number">0.5</span>, b[i] = (y - x) * <span class="number">0.5</span>i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> P, <span class="type">int</span> a[], <span class="type">int</span> b[], <span class="type">int</span> c[])</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> cplx a0[N], a1[N], b0[N], b1[N]; </span><br><span class="line">    <span class="type">int</span> M = <span class="built_in">sqrt</span>(P);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">        a0[i] = a[i] / M, a1[i] = a[i] % M;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; i++)</span><br><span class="line">        b0[i] = b[i] / M, b1[i] = b[i] % M;</span><br><span class="line">    <span class="type">int</span> lim = <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n + m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i++)</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span> | (i &amp; <span class="number">1</span> ? lim &gt;&gt; <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; lim; i &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">            w[i + j] = <span class="built_in">cplx</span>(<span class="built_in">cos</span>(PI / i * j), <span class="built_in">sin</span>(PI / i * j));</span><br><span class="line">    <span class="built_in">FFT2</span>(a0, a1, lim), <span class="built_in">FFT2</span>(b0, b1, lim);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i++) &#123;</span><br><span class="line">        cplx t = a0[i] + a1[i] * <span class="number">1</span>i;</span><br><span class="line">        b0[i] *= t, b1[i] *= t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">FFT</span>(b0, lim, <span class="number">0</span>), <span class="built_in">FFT</span>(b1, lim, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        <span class="keyword">using</span> u64 = <span class="type">uint64_t</span>;</span><br><span class="line">        u64 high = M * <span class="built_in">u64</span>(<span class="built_in">real</span>(b0[i]) + <span class="number">0.5</span>) + <span class="built_in">u64</span>(<span class="built_in">imag</span>(b0[i]) + <span class="number">0.5</span>);</span><br><span class="line">        u64 low = M * <span class="built_in">u64</span>(<span class="built_in">real</span>(b1[i]) + <span class="number">0.5</span>) + <span class="built_in">u64</span>(<span class="built_in">imag</span>(b1[i]) + <span class="number">0.5</span>);</span><br><span class="line">        c[i] = (high % P * M + low) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i++)</span><br><span class="line">        a0[i] = a1[i] = b0[i] = b1[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>modint</code> 版</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> cplx = complex&lt;<span class="type">double</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rev[N];</span><br><span class="line">cplx w[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FFT</span><span class="params">(cplx a[], <span class="type">int</span> n, <span class="type">bool</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i]) <span class="built_in">swap</span>(a[i], a[rev[i]]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j += i &lt;&lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + i; k++) &#123;</span><br><span class="line">                cplx x = a[k], y = a[k + i] * w[i + k - j];</span><br><span class="line">                a[k] = x + y, a[k + i] = x - y;</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">if</span> (t) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">reverse</span>(a + <span class="number">1</span>, a + n);</span><br><span class="line">    <span class="type">double</span> inv = <span class="number">1.0</span> / n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] *= inv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FFT2</span><span class="params">(cplx a[], cplx b[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] += b[i] * <span class="number">1</span>i;</span><br><span class="line">    <span class="built_in">FFT</span>(a, n, <span class="number">1</span>);</span><br><span class="line">    b[<span class="number">0</span>] = <span class="built_in">conj</span>(a[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) b[i] = <span class="built_in">conj</span>(a[n - i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cplx x = a[i], y = b[i];</span><br><span class="line">        a[i] = (y + x) * <span class="number">0.5</span>, b[i] = (y - x) * <span class="number">0.5</span>i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, mint a[], mint b[], mint c[])</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> cplx a0[N], a1[N], b0[N], b1[N];</span><br><span class="line">    <span class="type">int</span> M = <span class="built_in">sqrt</span>(mint::<span class="built_in">mod</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">        a0[i] = a[i].<span class="built_in">val</span>() / M, a1[i] = a[i].<span class="built_in">val</span>() % M;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; i++)</span><br><span class="line">        b0[i] = b[i].<span class="built_in">val</span>() / M, b1[i] = b[i].<span class="built_in">val</span>() % M;</span><br><span class="line">    <span class="type">int</span> lim = <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n + m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i++)</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span> | (i &amp; <span class="number">1</span> ? lim &gt;&gt; <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; lim; i &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">            w[i + j] = <span class="built_in">cplx</span>(<span class="built_in">cos</span>(PI / i * j), <span class="built_in">sin</span>(PI / i * j));</span><br><span class="line">    <span class="built_in">FFT2</span>(a0, a1, lim), <span class="built_in">FFT2</span>(b0, b1, lim);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i++) &#123;</span><br><span class="line">        cplx t = a0[i] + a1[i] * <span class="number">1</span>i;</span><br><span class="line">        b0[i] *= t, b1[i] *= t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">FFT</span>(b0, lim, <span class="number">0</span>), <span class="built_in">FFT</span>(b1, lim, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        <span class="keyword">using</span> u64 = <span class="type">uint64_t</span>;</span><br><span class="line">        u64 high = M * <span class="built_in">u64</span>(<span class="built_in">real</span>(b0[i]) + <span class="number">0.5</span>) + <span class="built_in">u64</span>(<span class="built_in">imag</span>(b0[i]) + <span class="number">0.5</span>);</span><br><span class="line">        u64 low = M * <span class="built_in">u64</span>(<span class="built_in">real</span>(b1[i]) + <span class="number">0.5</span>) + <span class="built_in">u64</span>(<span class="built_in">imag</span>(b1[i]) + <span class="number">0.5</span>);</span><br><span class="line">        c[i] = high % mint::<span class="built_in">mod</span>() * M + low;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i++)</span><br><span class="line">        a0[i] = a1[i] = b0[i] = b1[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多项式求逆-polyinv">多项式求逆 / polyInv</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> (a += b) &lt; P ? a : a - P; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> (a -= b) &lt; <span class="number">0</span> ? a + P : a; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> (<span class="type">uint64_t</span>)(<span class="type">uint32_t</span>)a * (<span class="type">uint32_t</span>)b % P; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ceil2</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Pow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> r = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a))</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = <span class="built_in">mul</span>(r, a);</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">precalc</span> &#123;</span><br><span class="line">    <span class="type">int</span> w[<span class="number">23</span>], iw[<span class="number">23</span>];</span><br><span class="line">    <span class="built_in">precalc</span>() &#123;</span><br><span class="line">        <span class="type">int</span> e[<span class="number">22</span>], ie[<span class="number">22</span>], now = <span class="number">15311432</span>, inow = <span class="number">469870224</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">21</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            e[i] = now, ie[i] = inow;</span><br><span class="line">            now = <span class="built_in">mul</span>(now, now), inow = <span class="built_in">mul</span>(inow, inow);</span><br><span class="line">        &#125;</span><br><span class="line">        now = inow = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">21</span>; i++) &#123;</span><br><span class="line">            w[i] = <span class="built_in">mul</span>(e[i], now), iw[i] = <span class="built_in">mul</span>(ie[i], inow);</span><br><span class="line">            now = <span class="built_in">mul</span>(now, ie[i]), inow = <span class="built_in">mul</span>(inow, e[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; pre;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DIF</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n &gt;&gt; <span class="number">1</span>, l = <span class="number">1</span>; i; i &gt;&gt;= <span class="number">1</span>, l &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x = a[k], y = <span class="built_in">mul</span>(a[k + i], now);</span><br><span class="line">                a[k] = <span class="built_in">add</span>(x, y), a[k + i] = <span class="built_in">sub</span>(x, y);</span><br><span class="line">            &#125;</span><br><span class="line">            now = <span class="built_in">mul</span>(now, pre.w[__builtin_ctz(j + <span class="number">1</span>)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">IDIF</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, l = n &gt;&gt; <span class="number">1</span>; l; i &lt;&lt;= <span class="number">1</span>, l &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x = a[k], y = a[k + i];</span><br><span class="line">                a[k] = <span class="built_in">add</span>(x, y), a[k + i] = <span class="built_in">mul</span>(x - y + P, now);</span><br><span class="line">            &#125;</span><br><span class="line">            now = <span class="built_in">mul</span>(now, pre.iw[__builtin_ctz(j + <span class="number">1</span>)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> inv = <span class="built_in">Pow</span>(n, P - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] = <span class="built_in">mul</span>(a[i], inv);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">polyInv</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> a[], <span class="type">int</span> b[])</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> c[N];</span><br><span class="line">    <span class="type">int</span> lim = <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, lim * <span class="number">8</span>);</span><br><span class="line">    b[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt; lim; k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(c, a, k * <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">DIF</span>(b, k * <span class="number">4</span>), <span class="built_in">DIF</span>(c, k * <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k * <span class="number">4</span>; i++)</span><br><span class="line">            b[i] = <span class="built_in">mul</span>(b[i], <span class="number">2</span> + P - <span class="built_in">mul</span>(c[i], b[i]));</span><br><span class="line">        <span class="built_in">IDIF</span>(b, k * <span class="number">4</span>), <span class="built_in">memset</span>(b + k * <span class="number">2</span>, <span class="number">0</span>, k * <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(c, <span class="number">0</span>, lim * <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>modint</code> 版</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> mint = static_modint&lt;<span class="number">998244353</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ceil2</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n); &#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">precalc</span> &#123;</span><br><span class="line">    mint w[<span class="number">23</span>], iw[<span class="number">23</span>];</span><br><span class="line">    <span class="built_in">precalc</span>() &#123;</span><br><span class="line">        mint e[<span class="number">22</span>], ie[<span class="number">22</span>], now = <span class="number">15311432</span>, inow = <span class="number">469870224</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">21</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            e[i] = now, ie[i] = inow;</span><br><span class="line">            now *= now, inow *= inow;</span><br><span class="line">        &#125;</span><br><span class="line">        now = inow = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">21</span>; i++) &#123;</span><br><span class="line">            w[i] = e[i] * now, iw[i] = ie[i] * inow;</span><br><span class="line">            now *= ie[i], inow *= e[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; pre;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DIF</span><span class="params">(mint a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n &gt;&gt; <span class="number">1</span>, l = <span class="number">1</span>; i; i &gt;&gt;= <span class="number">1</span>, l &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        mint now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                mint x = a[k], y = a[k + i] * now;</span><br><span class="line">                a[k] = x + y, a[k + i] = x - y;</span><br><span class="line">            &#125;</span><br><span class="line">            now *= pre.w[__builtin_ctz(j + <span class="number">1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">IDIF</span><span class="params">(mint a[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, l = n &gt;&gt; <span class="number">1</span>; l; i &lt;&lt;= <span class="number">1</span>, l &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        mint now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">            <span class="type">int</span> p = j * i * <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = p; k &lt; p + i; k++) &#123;</span><br><span class="line">                mint x = a[k], y = a[k + i];</span><br><span class="line">                a[k] = x + y, a[k + i] = (x - y) * now;</span><br><span class="line">            &#125;</span><br><span class="line">            now *= pre.iw[__builtin_ctz(j + <span class="number">1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mint inv = <span class="built_in">mint</span>(n).<span class="built_in">inv</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] *= inv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">polyInv</span><span class="params">(<span class="type">int</span> n, mint a[], mint b[])</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> mint c[N];</span><br><span class="line">    <span class="type">int</span> lim = <span class="number">2</span> &lt;&lt; __builtin_ia32_bsrsi(n - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, lim * <span class="number">8</span>);</span><br><span class="line">    b[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt; lim; k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(c, a, k * <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">DIF</span>(b, k * <span class="number">4</span>), <span class="built_in">DIF</span>(c, k * <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k * <span class="number">4</span>; i++)</span><br><span class="line">            b[i] *= <span class="number">2</span> - c[i] * b[i];</span><br><span class="line">        <span class="built_in">IDIF</span>(b, k * <span class="number">4</span>), <span class="built_in">memset</span>(b + k * <span class="number">2</span>, <span class="number">0</span>, k * <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(c, <span class="number">0</span>, lim * <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自然数等幂求和">自然数等幂求和</h2>
<h2 id="中国剩余定理">中国剩余定理</h2>
<h2 id="扩展中国剩余定理-excrt">扩展中国剩余定理 / exCRT</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll A, ll B, ll P)</span> </span>&#123;</span><br><span class="line">    ll C = A * B - (ll)((<span class="type">long</span> <span class="type">double</span>)A * B / P + <span class="number">0.5</span>) * P;</span><br><span class="line">    <span class="keyword">return</span> C &lt; <span class="number">0</span> ? C + P : C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(ll a, ll b, ll&amp; d, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123; d = a, x = <span class="number">1</span>, y = <span class="number">0</span>; <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="built_in">exgcd</span>(b, a % b, d, y, x), y -= a / b * x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exCRT</span><span class="params">(ll&amp; b1, ll&amp; m1, ll b2, ll m2)</span> </span>&#123;</span><br><span class="line">    ll d, k1, k2; <span class="built_in">exgcd</span>(m1, m2, d, k1, k2), m2 /= d;</span><br><span class="line">    b1 = (b1 + <span class="built_in">mul</span>(<span class="built_in">mul</span>(k1 % m2, (b2 - b1) / d % m2, m2), m1, m1 * m2)) % (m1 *= m2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="杜教筛">杜教筛</h2>
<h2 id="min-25-筛-min25">Min-25 筛 / min25</h2>
<h3 id="定义">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll f1[N], f2[N];</span><br></pre></td></tr></table></figure>
<h3 id="函数">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">min25</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> lim = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, lim) f1[i] = i - <span class="number">1</span>, f2[i] = n / i - <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(p, <span class="number">2</span>, lim) <span class="keyword">if</span> (f1[p] != f1[p - <span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="type">int</span> w1 = lim / p;</span><br><span class="line">        ll x = f1[p - <span class="number">1</span>], w3 = (ll)p * p, w2 = <span class="built_in">min</span>((ll)lim, n / w3), d = n / p;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, w1) f2[i] -= f2[i * p] - x;</span><br><span class="line">        <span class="built_in">rep</span>(i, w1 + <span class="number">1</span>, w2) f2[i] -= f1[d / i] - x;</span><br><span class="line">        <span class="built_in">per</span>(i, lim, w3) f1[i] -= f1[i / p] - x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f2[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="exbsgs">exBSGS</h2>
<h3 id="定义-1">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br></pre></td></tr></table></figure>
<h3 id="函数-1">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">BSGS</span><span class="params">(ll pls, ll a, ll b, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">    pls %= p, a %= p, b %= p; mp.<span class="built_in">clear</span>();</span><br><span class="line">    ll m = <span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(p)), ls = <span class="number">1</span>, rs = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, m) mp[ls * b % p] = i, ls = ls * a % p;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, m) &#123;</span><br><span class="line">        rs = rs * ls % p;</span><br><span class="line">        <span class="keyword">if</span> (mp.<span class="built_in">count</span>(rs * pls % p)) <span class="keyword">return</span> i * m - mp[rs * pls % p];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exBSGS</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">    a %= p, b %= p;</span><br><span class="line">    <span class="type">int</span> pls = <span class="number">1</span>, cnt = <span class="number">0</span>, g;</span><br><span class="line">    <span class="keyword">while</span> ((g = __gcd(a, p)) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b == pls) <span class="keyword">return</span> cnt;</span><br><span class="line">        <span class="keyword">if</span> (b % g) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        p /= g, b /= g, pls = pls * <span class="built_in">ll</span>(a / g) % p, cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">BSGS</span>(pls, a, b, p);</span><br><span class="line">    <span class="keyword">return</span> ~ret ? ret + cnt : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="cipolla">cipolla</h2>
<h3 id="定义-2">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n; ll II;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">cplx</span> &#123;</span><br><span class="line">    ll r, i;</span><br><span class="line">    cplx <span class="keyword">operator</span> *(<span class="type">const</span> cplx&amp; b) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;(r * b.r + i * b.i % P * II) % P, (r * b.i + i * b.r) % P&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; U = &#123;<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br></pre></td></tr></table></figure>
<p><code>modint</code> 版</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mint n, II;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">cplx</span> &#123;</span><br><span class="line">    mint r, i;</span><br><span class="line">    cplx <span class="keyword">operator</span> *(<span class="type">const</span> cplx&amp; b) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;r * b.r + i * b.i * II, r * b.i + i * b.r&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; U = &#123;<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="函数-2">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">pow1</span><span class="params">(ll a, <span class="type">int</span> n, ll r = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = a * a % P)</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = r * a % P;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">cplx <span class="title">pow2</span><span class="params">(cplx a, <span class="type">int</span> n, cplx r = U)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = a * a)</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = r * a;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cipolla</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (P == <span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pow1</span>(n, P / <span class="number">2</span>) != <span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="type">static</span> mt19937 gen;</span><br><span class="line">    ll a;</span><br><span class="line">    <span class="keyword">do</span> a = <span class="built_in">gen</span>() % P, II = (a * a - n + P) % P; <span class="keyword">while</span> (<span class="built_in">pow1</span>(II, P / <span class="number">2</span>) == <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow2</span>(&#123;a, <span class="number">1</span>&#125;, P / <span class="number">2</span> + <span class="number">1</span>).r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>modint</code> 版</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cplx <span class="title">Pow</span><span class="params">(cplx a, <span class="type">int</span> n, cplx r = U)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = a * a)</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = r * a;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cipolla</span><span class="params">(mint n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (P == <span class="number">2</span>) <span class="keyword">return</span> n.<span class="built_in">val</span>();</span><br><span class="line">    <span class="keyword">if</span> (n.<span class="built_in">pow</span>(P / <span class="number">2</span>) != <span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    mint a;</span><br><span class="line">    <span class="keyword">do</span> a = <span class="built_in">rand</span>(), II = a * a - n; <span class="keyword">while</span> (a == <span class="number">0</span> || II.<span class="built_in">pow</span>(P / <span class="number">2</span>) == <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Pow</span>(&#123;a, <span class="number">1</span>&#125;, P / <span class="number">2</span> + <span class="number">1</span>).r.<span class="built_in">val</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="miller-rabin-pollard-rho">Miller Rabin &amp; Pollard Rho</h2>
<h3 id="定义-3">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;ll&gt; prime;</span><br></pre></td></tr></table></figure>
<h3 id="函数-3">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">mul</span><span class="params">(ll a, ll b, ll p)</span> </span>&#123;</span><br><span class="line">    ll c = a * b - <span class="built_in">ll</span>((<span class="type">long</span> <span class="type">double</span>)a * b / p + <span class="number">0.5</span>) * p;</span><br><span class="line">    <span class="keyword">return</span> c &lt; <span class="number">0</span> ? c + p : c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(ll a, ll n, ll p)</span> </span>&#123;</span><br><span class="line">    ll r = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a, p))</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) r = <span class="built_in">mul</span>(r, a, p);</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">    ll d = n - <span class="number">1</span> &gt;&gt; __builtin_ctzll(n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (ll a : &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>&#125;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        ll t = d, x = <span class="built_in">Pow</span>(a, d, n);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span> (t != n - <span class="number">1</span> &amp; x != <span class="number">1</span> &amp; x != n - <span class="number">1</span>)</span><br><span class="line">            x = <span class="built_in">mul</span>(x, x, n), t &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x != n - <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">find</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> mt19937_64 gen;</span><br><span class="line">    ll x = <span class="built_in">gen</span>() % n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> L = <span class="number">128</span>;; L &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        ll y = x;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; L; i += <span class="number">128</span>) &#123;</span><br><span class="line">            ll z = x, p = <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">rep</span>(j, <span class="number">0</span>, <span class="number">127</span>) &#123;</span><br><span class="line">                x = <span class="built_in">mul</span>(x, x, n) + <span class="number">1</span>;</span><br><span class="line">                p = <span class="built_in">mul</span>(p, <span class="built_in">abs</span>(x - y), n);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">gcd</span>(p, n) == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">rep</span>(j, <span class="number">0</span>, <span class="number">127</span>) &#123;</span><br><span class="line">                z = <span class="built_in">mul</span>(z, z, n) + <span class="number">1</span>;</span><br><span class="line">                ll g = <span class="built_in">gcd</span>(<span class="built_in">abs</span>(z - y), n);</span><br><span class="line">                <span class="keyword">if</span> (g &gt; <span class="number">1</span>) <span class="keyword">return</span> g;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">factorize</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">check</span>(n)) <span class="keyword">return</span> prime.<span class="built_in">pb</span>(n);</span><br><span class="line">    ll d;</span><br><span class="line">    <span class="keyword">do</span> d = <span class="built_in">find</span>(n); <span class="keyword">while</span> (d == n);</span><br><span class="line">    <span class="built_in">factorize</span>(d), <span class="built_in">factorize</span>(n / d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数据结构">数据结构</h1>
<h2 id="动态树-lct">动态树 / LCT</h2>
<h3 id="普通版">普通版</h3>
<h4 id="定义-4">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> c[<span class="number">2</span>], f; <span class="type">bool</span> r; &#125; c[N];</span><br></pre></td></tr></table></figure>
<h4 id="函数-4">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">id</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123; <span class="keyword">return</span> c[c[o].f].c[<span class="number">1</span>] == o; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">nrt</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123; <span class="keyword">return</span> c[c[o].f].c[<span class="number">0</span>] == o | c[c[o].f].c[<span class="number">1</span>] == o; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pu</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rev</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">swap</span>(c[o].c[<span class="number">0</span>], c[o].c[<span class="number">1</span>]), c[o].r ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pd</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (c[o].r) <span class="built_in">rev</span>(c[o].c[<span class="number">0</span>]), <span class="built_in">rev</span>(c[o].c[<span class="number">1</span>]), c[o].r = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = c[o].c[!d], &amp;x = c[k].c[d];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">nrt</span>(o)) c[c[o].f].c[<span class="built_in">id</span>(o)] = k;</span><br><span class="line">    c[k].f = c[o].f;</span><br><span class="line">    <span class="built_in">pu</span>(x = c[c[o].c[!d] = x].f = o);</span><br><span class="line">    <span class="built_in">pu</span>(c[o].f = k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123; <span class="keyword">if</span> (<span class="built_in">nrt</span>(o)) <span class="built_in">dfs</span>(c[o].f); <span class="built_in">pd</span>(o); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">dfs</span>(o);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> f; <span class="built_in">nrt</span>(o); <span class="built_in">rot</span>(c[o].f, !<span class="built_in">id</span>(o)))</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">nrt</span>(f = c[o].f)) <span class="built_in">rot</span>(<span class="built_in">id</span>(o) == <span class="built_in">id</span>(f) ? c[f].f : f, !<span class="built_in">id</span>(o));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">acc</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; o; o = c[x = o].f) <span class="built_in">splay</span>(o), c[o].c[<span class="number">1</span>] = x, <span class="built_in">pu</span>(o);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">rev</span>(<span class="built_in">acc</span>(u)), <span class="built_in">splay</span>(u), c[u].f = v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">rev</span>(<span class="built_in">acc</span>(u)), <span class="built_in">acc</span>(v), <span class="built_in">splay</span>(v), c[v].c[<span class="number">0</span>] = c[u].f = <span class="number">0</span>, <span class="built_in">pu</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="维护子树-size-版">维护子树 <code>size</code> 版</h3>
<h4 id="定义-5">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> c[<span class="number">2</span>], f, s, si; <span class="type">bool</span> r; &#125; c[N];</span><br></pre></td></tr></table></figure>
<h4 id="函数-5">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">id</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123; <span class="keyword">return</span> c[c[o].f].c[<span class="number">1</span>] == o; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">nrt</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123; <span class="keyword">return</span> c[c[o].f].c[<span class="number">0</span>] == o | c[c[o].f].c[<span class="number">1</span>] == o; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pu</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    c[o].s = c[c[o].c[<span class="number">0</span>]].s + c[c[o].c[<span class="number">1</span>]].s + c[o].si + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rev</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">swap</span>(c[o].c[<span class="number">0</span>], c[o].c[<span class="number">1</span>]), c[o].r ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pd</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (c[o].r) <span class="built_in">rev</span>(c[o].c[<span class="number">0</span>]), <span class="built_in">rev</span>(c[o].c[<span class="number">1</span>]), c[o].r = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = c[o].c[!d], &amp;x = c[k].c[d];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">nrt</span>(o)) c[c[o].f].c[<span class="built_in">id</span>(o)] = k;</span><br><span class="line">    c[k].f = c[o].f;</span><br><span class="line">    <span class="built_in">pu</span>(x = c[c[o].c[!d] = x].f = o);</span><br><span class="line">    <span class="built_in">pu</span>(c[o].f = k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123; <span class="keyword">if</span> (<span class="built_in">nrt</span>(o)) <span class="built_in">dfs</span>(c[o].f); <span class="built_in">pd</span>(o); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">dfs</span>(o);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> f; <span class="built_in">nrt</span>(o); <span class="built_in">rot</span>(c[o].f, !<span class="built_in">id</span>(o)))</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">nrt</span>(f = c[o].f)) <span class="built_in">rot</span>(<span class="built_in">id</span>(o) == <span class="built_in">id</span>(f) ? c[f].f : f, !<span class="built_in">id</span>(o));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">acc</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; o; o = c[x = o].f) &#123;</span><br><span class="line">        <span class="built_in">splay</span>(o);</span><br><span class="line">        c[o].si += c[c[o].c[<span class="number">1</span>]].s - c[x].s;</span><br><span class="line">        c[o].c[<span class="number">1</span>] = x, <span class="built_in">pu</span>(o);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">rev</span>(<span class="built_in">acc</span>(u)), c[u].f = v, c[v].s += c[u].s, c[v].si += c[u].s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">rev</span>(<span class="built_in">acc</span>(u)), <span class="built_in">acc</span>(v), <span class="built_in">splay</span>(v), c[v][<span class="number">0</span>] = f[u] = <span class="number">0</span>, <span class="built_in">pu</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pbdstree">pbds::tree</h2>
<h4 id="定义-6">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">using</span> Set = tree&lt;T, null_type, less&lt;T&gt;, rb_tree_tag, tree_order_statistics_node_update&gt;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt; <span class="keyword">using</span> Map = tree&lt;K, V, less&lt;K&gt;, rb_tree_tag, tree_order_statistics_node_update&gt;;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ins(T, x) (T).insert(x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> era(T, x) (T).erase(x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rk(T, x) ((T).order_of_key(x) + 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> kth(T, x) (*(T).find_by_order(x - 1))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pre(T, x) (*prev((T).lower_bound(x)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> nxt(T, x) (*(T).upper_bound(x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bld(T, l, r) (T).copy_from_range(l, r)</span></span><br></pre></td></tr></table></figure>
<h2 id="rbst">RBST</h2>
<h3 id="普通版-1">普通版</h3>
<h4 id="定义-7">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> l, r, s; &#125; c[N];</span><br></pre></td></tr></table></figure>
<h4 id="函数-6">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pu</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    c[o].s = c[c[o].l].s + c[c[o].r].s + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> k, <span class="type">int</span>&amp; u, <span class="type">int</span>&amp; v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!o) u = v = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (k &lt;= c[c[o].l].s) <span class="built_in">split</span>(c[v = o].l, k, u, c[o].l), <span class="built_in">pu</span>(o);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">split</span>(c[u = o].r, k - c[c[o].l].s - <span class="number">1</span>, c[o].r, v), <span class="built_in">pu</span>(o);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> mt19937 gen;</span><br><span class="line">    <span class="keyword">if</span> (!u || !v) <span class="keyword">return</span> u + v;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">gen</span>() % (c[u].s + c[v].s) &lt; c[u].s)</span><br><span class="line">        <span class="keyword">return</span> c[u].r = <span class="built_in">merge</span>(c[u].r, v), <span class="built_in">pu</span>(u), u;</span><br><span class="line">    <span class="keyword">return</span> c[v].l = <span class="built_in">merge</span>(u, c[v].l), <span class="built_in">pu</span>(v), v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> m = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    c[m].s = r - l + <span class="number">1</span>;</span><br><span class="line">    c[m].l = <span class="built_in">build</span>(l, m - <span class="number">1</span>);</span><br><span class="line">    c[m].r = <span class="built_in">build</span>(m + <span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="可持久化版">可持久化版</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> int64;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64 <span class="title">Fingerprint</span><span class="params">(int64 x)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> int64 kMul = <span class="number">0x9ddfea08eb382d69</span>ULL;</span><br><span class="line">    x *= kMul, x ^= x &gt;&gt; <span class="number">47</span>;</span><br><span class="line">    x *= kMul, x ^= x &gt;&gt; <span class="number">47</span>;</span><br><span class="line">    x *= kMul, x ^= x &gt;&gt; <span class="number">47</span>;</span><br><span class="line">    <span class="keyword">return</span> x * kMul;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64 <span class="title">Random</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> int64 Seed = <span class="number">2</span>;</span><br><span class="line">    Seed += <span class="built_in">Fingerprint</span>(Seed);</span><br><span class="line">    <span class="keyword">return</span> Seed &amp; numeric_limits&lt;int64&gt;::<span class="built_in">max</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> DataType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RBST</span> &#123;</span><br><span class="line">    RBST *ChildL, *ChildR;</span><br><span class="line">    <span class="type">int</span> Size;</span><br><span class="line">    DataType Data;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RBST</span>() &#123; ChildL = ChildR = <span class="number">0</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetSize</span><span class="params">(<span class="type">const</span> RBST* root)</span> </span>&#123; <span class="keyword">return</span> root ? root-&gt;Size : <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LowerBoundIndex</span><span class="params">(<span class="type">const</span> RBST* root, DataType x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &lt;= root-&gt;Data) <span class="keyword">return</span> <span class="built_in">LowerBoundIndex</span>(root-&gt;ChildL, x);</span><br><span class="line">    <span class="type">int</span> sizeL = <span class="built_in">GetSize</span>(root-&gt;ChildL);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">LowerBoundIndex</span>(root-&gt;ChildR, x) + sizeL + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DataType <span class="title">Select</span><span class="params">(<span class="type">const</span> RBST* root, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> sizeL = <span class="built_in">GetSize</span>(root-&gt;ChildL);</span><br><span class="line">    <span class="keyword">if</span> (index == sizeL) <span class="keyword">return</span> root-&gt;Data;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; sizeL) <span class="keyword">return</span> <span class="built_in">Select</span>(root-&gt;ChildL, index);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Select</span>(root-&gt;ChildR, index - sizeL - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">RBST* <span class="title">SetSize</span><span class="params">(RBST* root)</span> </span>&#123;</span><br><span class="line">    root-&gt;Size = <span class="built_in">GetSize</span>(root-&gt;ChildL) + <span class="built_in">GetSize</span>(root-&gt;ChildR) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RBSTree</span> &#123;</span><br><span class="line">    vector&lt;RBST*&gt; Nodes;</span><br><span class="line"></span><br><span class="line">    <span class="function">RBST* <span class="title">NewNode</span><span class="params">(RBST* node)</span> </span>&#123;</span><br><span class="line">        Nodes.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">RBST</span>(*node));</span><br><span class="line">        <span class="keyword">return</span> Nodes.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Split</span><span class="params">(RBST* root, DataType x, RBST*&amp; treeL, RBST*&amp; treeR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            treeL = treeR = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= root-&gt;Data) &#123;</span><br><span class="line">            RBST *newRoot = <span class="built_in">NewNode</span>(root);</span><br><span class="line">            <span class="built_in">Split</span>(root-&gt;ChildL, x, treeL, newRoot-&gt;ChildL);</span><br><span class="line">            treeR = <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            RBST* newRoot = <span class="built_in">NewNode</span>(root);</span><br><span class="line">            <span class="built_in">Split</span>(root-&gt;ChildR, x, newRoot-&gt;ChildR, treeR);</span><br><span class="line">            treeL = <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">RBST* <span class="title">Join</span><span class="params">(RBST* treeL, RBST* treeR)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> sizeL = <span class="built_in">GetSize</span>(treeL);</span><br><span class="line">        <span class="type">int</span> sizeR = <span class="built_in">GetSize</span>(treeR);</span><br><span class="line">        <span class="type">int</span> size = sizeL + sizeR;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Random</span>() % size &lt; sizeL) &#123;</span><br><span class="line">            RBST* newRoot = <span class="built_in">NewNode</span>(treeL);</span><br><span class="line">            newRoot-&gt;ChildR = <span class="built_in">Join</span>(treeL-&gt;ChildR, treeR);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            RBST* newRoot = <span class="built_in">NewNode</span>(treeR);</span><br><span class="line">            newRoot-&gt;ChildL = <span class="built_in">Join</span>(treeL, treeR-&gt;ChildL);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">RBST* <span class="title">InsertAsRoot</span><span class="params">(RBST* root, DataType item)</span> </span>&#123;</span><br><span class="line">        Nodes.<span class="built_in">push_back</span>(<span class="keyword">new</span> RBST);</span><br><span class="line">        RBST *newRoot = Nodes.<span class="built_in">back</span>();</span><br><span class="line">        newRoot-&gt;Data = item;</span><br><span class="line">        <span class="built_in">Split</span>(root, item + <span class="number">1</span>, newRoot-&gt;ChildL, newRoot-&gt;ChildR);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">RBST* <span class="title">Insert</span><span class="params">(RBST* root, DataType item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Random</span>() % (<span class="built_in">GetSize</span>(root) + <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">InsertAsRoot</span>(root, item);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item &lt; root-&gt;Data) &#123;</span><br><span class="line">            RBST *newRoot = <span class="built_in">NewNode</span>(root);</span><br><span class="line">            newRoot-&gt;ChildL = <span class="built_in">Insert</span>(root-&gt;ChildL, item);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            RBST *newRoot = <span class="built_in">NewNode</span>(root);</span><br><span class="line">            newRoot-&gt;ChildR = <span class="built_in">Insert</span>(root-&gt;ChildR, item);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">SetSize</span>(newRoot);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">RBST* <span class="title">Remove</span><span class="params">(RBST* root, DataType item)</span> </span>&#123;</span><br><span class="line">        RBST *tree1, *tree2, *tree3, *tree4 = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">Split</span>(root, item, tree1, tree2);</span><br><span class="line">        <span class="built_in">Split</span>(tree2, item + <span class="number">1</span>, tree2, tree3);</span><br><span class="line">        <span class="keyword">if</span> (tree2) tree4 = <span class="built_in">Join</span>(tree2-&gt;ChildL, tree2-&gt;ChildR);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Join</span>(<span class="built_in">Join</span>(tree1, tree4), tree3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Nodes.<span class="built_in">size</span>(); ++i) <span class="keyword">delete</span> Nodes[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="k-d-树">K-D 树</h2>
<h3 id="定义-8">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> mid ((l + r) &gt;&gt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lc (o &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rc (o &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lch l, mid, lc</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rch mid + 1, r, rc</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> D, L[N * <span class="number">4</span>][K], R[N * <span class="number">4</span>][K];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> x[K];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123; <span class="built_in">For</span>(i, <span class="number">0</span>, K) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x[i]); &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;(<span class="type">const</span> node&amp; rhs)<span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x[D] &lt; rhs.x[D];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; a[N];</span><br></pre></td></tr></table></figure>
<h3 id="函数-7">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">sq</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; <span class="keyword">return</span> x * x; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pu</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) &#123;</span><br><span class="line">        L[o][i] = <span class="built_in">min</span>(L[lc][i], L[rc][i]);</span><br><span class="line">        R[o][i] = <span class="built_in">max</span>(R[lc][i], R[rc][i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        <span class="built_in">For</span>(i, <span class="number">0</span>, K) L[o][i] = R[o][i] = a[l].x[i];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> va[K] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) &#123;</span><br><span class="line">        <span class="type">double</span> av = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(j, l, r) av += a[j].x[i];</span><br><span class="line">        av /= r - l + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(j, l, r) va[i] += <span class="built_in">sq</span>(a[j].x[i] - av);</span><br><span class="line">    &#125;</span><br><span class="line">    D = <span class="built_in">max_element</span>(va, va + K) - va;</span><br><span class="line">    <span class="built_in">nth_element</span>(a + l, a + mid, a + r + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(lch), <span class="built_in">build</span>(rch), <span class="built_in">pu</span>(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="欧几里得距离平方">欧几里得距离平方</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">sq</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1ll</span> * x * x; &#125;</span><br><span class="line"><span class="function">ll <span class="title">mine</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> x[], ll re = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re += <span class="built_in">sq</span>(<span class="built_in">max</span>(L[o][i] - x[i], <span class="number">0</span>)) + <span class="built_in">sq</span>(<span class="built_in">max</span>(x[i] - R[o][i], <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">maxe</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> x[], ll re = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re += <span class="built_in">max</span>(<span class="built_in">sq</span>(x[i] - L[o][i]), <span class="built_in">sq</span>(x[i] - R[o][i]));</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="曼哈顿距离">曼哈顿距离</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">minm</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> x[], <span class="type">int</span> re = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re += <span class="built_in">max</span>(L[o][i] - x[i], <span class="number">0</span>) + <span class="built_in">max</span>(x[i] - R[o][i], <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxm</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> x[], <span class="type">int</span> re = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re += <span class="built_in">max</span>(<span class="built_in">abs</span>(x[i] - L[o][i]), <span class="built_in">abs</span>(x[i] - R[o][i]));</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="切比雪夫距离">切比雪夫距离</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">minc</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> x[], <span class="type">int</span> re = inf)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re = <span class="built_in">max</span>(re, <span class="built_in">max</span>(L[o][i] - x[i], <span class="number">0</span>) + <span class="built_in">max</span>(x[i] - R[o][i], <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxc</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> x[], <span class="type">int</span> re = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re = <span class="built_in">max</span>(&#123;re, <span class="built_in">abs</span>(x[i] - L[o][i]), <span class="built_in">abs</span>(x[i] - R[o][i])&#125;);</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="最近点查询">最近点查询</h3>
<h4 id="定义-9">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll res;</span><br></pre></td></tr></table></figure>
<h4 id="函数-8">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">qry</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> <span class="built_in">void</span>(res = <span class="built_in">mine</span>(o, x));</span><br><span class="line">    ll dl = <span class="built_in">mine</span>(lc, x), dr = <span class="built_in">mine</span>(rc, x);</span><br><span class="line">    <span class="keyword">if</span> (dl &lt; dr) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dl &lt; res) <span class="built_in">qry</span>(x, lch);</span><br><span class="line">        <span class="keyword">if</span> (dr &lt; res) <span class="built_in">qry</span>(x, rch);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (dr &lt; res) <span class="built_in">qry</span>(x, rch);</span><br><span class="line">        <span class="keyword">if</span> (dl &lt; res) <span class="built_in">qry</span>(x, lch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="初始化">初始化</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = inf;</span><br></pre></td></tr></table></figure>
<h3 id="最远点查询">最远点查询</h3>
<h4 id="定义-10">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll res;</span><br></pre></td></tr></table></figure>
<h4 id="函数-9">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">qry</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> <span class="built_in">void</span>(res = <span class="built_in">maxe</span>(o, x));</span><br><span class="line">    ll dl = <span class="built_in">maxe</span>(lc, x), dr = <span class="built_in">maxe</span>(rc, x);</span><br><span class="line">    <span class="keyword">if</span> (dl &gt; dr) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dl &gt; res) <span class="built_in">qry</span>(x, lch);</span><br><span class="line">        <span class="keyword">if</span> (dr &gt; res) <span class="built_in">qry</span>(x, rch);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (dr &gt; res) <span class="built_in">qry</span>(x, rch);</span><br><span class="line">        <span class="keyword">if</span> (dl &gt; res) <span class="built_in">qry</span>(x, lch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="初始化-1">初始化</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<h3 id="矩形判定">矩形判定</h3>
<h4 id="矩形是否包含所有点">矩形是否包含所有点</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk1</span><span class="params">(<span class="type">int</span> l[], <span class="type">int</span> r[], <span class="type">int</span> o, <span class="type">int</span> re = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re &amp;= l[i] &lt;= L[o][i] &amp;&amp; R[o][i] &lt;= r[i];</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="矩形是否可能包含点">矩形是否可能包含点</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk2</span><span class="params">(<span class="type">int</span> l[], <span class="type">int</span> r[], <span class="type">int</span> o, <span class="type">int</span> re = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">For</span>(i, <span class="number">0</span>, K) re &amp;= <span class="built_in">max</span>(l[i], L[o][i]) &lt;= <span class="built_in">min</span>(r[i], R[o][i]);</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="圆判定">圆判定</h3>
<h4 id="圆是否包含所有点">圆是否包含所有点</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk1</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> r, <span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">maxe</span>(x, o) &lt;= <span class="number">1ll</span> * r * r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="圆是否可能包含点">圆是否可能包含点</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk2</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> r, <span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mine</span>(x, o) &lt;= <span class="number">1ll</span> * r * r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="图论和树">图论和树</h1>
<h2 id="虚树-vtree">虚树 / vtree</h2>
<h3 id="vector-版"><code>vector</code> 版</h3>
<h4 id="定义-11">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, a[N], tp, stk[N];</span><br><span class="line"><span class="type">int</span> idx, dfn[N], d[N], fa[<span class="number">20</span>][N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[N], T[N];</span><br></pre></td></tr></table></figure>
<h4 id="函数-10">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u] = ++idx;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, <span class="number">19</span>) fa[i][u] = fa[i - <span class="number">1</span>][fa[i - <span class="number">1</span>][u]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : G[u]) <span class="keyword">if</span> (v != fa[<span class="number">0</span>][u])</span><br><span class="line">        d[v] = d[u] + <span class="number">1</span>, fa[<span class="number">0</span>][v] = u, <span class="built_in">dfs</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (d[u] &lt; d[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">0</span>, <span class="number">19</span>) <span class="keyword">if</span> (d[u] - d[v] &gt;&gt; i &amp; <span class="number">1</span>) u = fa[i][u];</span><br><span class="line">    <span class="keyword">if</span> (u == v) <span class="keyword">return</span> u;</span><br><span class="line">    <span class="built_in">per</span>(i, <span class="number">19</span>, <span class="number">0</span>) <span class="keyword">if</span> (fa[i][u] != fa[i][v]) u = fa[i][u], v = fa[i][v];</span><br><span class="line">    <span class="keyword">return</span> fa[<span class="number">0</span>][u];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bld</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + k + <span class="number">1</span>, [](<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> dfn[a] &lt; dfn[b]; &#125;);</span><br><span class="line">    stk[++tp] = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, k) <span class="keyword">if</span> (a[i] &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="built_in">lca</span>(a[i], stk[tp]);</span><br><span class="line">        <span class="keyword">while</span> (d[stk[tp]] &gt; d[x]) tp--, T[d[stk[tp]] &gt; d[x] ? stk[tp] : x].<span class="built_in">pb</span>(stk[tp + <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (stk[tp] != x) stk[++tp] = x;</span><br><span class="line">        stk[++tp] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (--tp) T[stk[tp]].<span class="built_in">pb</span>(stk[tp + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clr</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : G[u]) <span class="built_in">clr</span>(v); T[u].<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="快很多版">快很多版</h3>
<h4 id="定义-12">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, a[N], p, stk[N];</span><br><span class="line"><span class="type">int</span> d[N], fa[N], sz[N], son[N], tp[N], idx, dfn[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[N];</span><br><span class="line"><span class="type">int</span> eid, he[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123; <span class="type">int</span> v, n; &#125; e[N &lt;&lt; <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h4 id="函数-11">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    sz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : G[u]) &#123;</span><br><span class="line">        d[v] = d[u] + <span class="number">1</span>, <span class="built_in">dfs1</span>(v), sz[u] += sz[v];</span><br><span class="line">        <span class="keyword">if</span> (sz[v] &gt; sz[son[u]]) son[u] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> top)</span> </span>&#123;</span><br><span class="line">    tp[u] = top, dfn[u] = ++idx;</span><br><span class="line">    <span class="keyword">if</span> (son[u]) <span class="built_in">dfs2</span>(son[u], top);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : G[u]) <span class="keyword">if</span> (v != son[u]) <span class="built_in">dfs2</span>(v, v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; tp[u] != tp[v]; d[tp[u]] &gt; d[tp[v]] ? u = fa[tp[u]] : v = fa[tp[v]]);</span><br><span class="line">    <span class="keyword">return</span> d[u] &lt; d[v] ? u : v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    e[++eid] = &#123;v, he[u]&#125;, he[u] = eid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bld</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + k + <span class="number">1</span>, [](<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> dfn[a] &lt; dfn[b]; &#125;);</span><br><span class="line">    stk[++p] = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, k) <span class="keyword">if</span> (a[i] &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="built_in">lca</span>(a[i], stk[p]);</span><br><span class="line">        <span class="keyword">while</span> (d[stk[p]] &gt; d[x])</span><br><span class="line">            p--, <span class="built_in">add</span>(d[stk[p]] &gt; d[x] ? stk[p] : x, stk[p + <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (stk[p] != x) stk[++p] = x;</span><br><span class="line">        stk[++p] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (--p) <span class="built_in">add</span>(stk[p], stk[p + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最大流-mf">最大流 / mf</h2>
<h3 id="定义-13">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>, M = <span class="comment">/**/</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> eid, deg[N], G[M &lt;&lt; <span class="number">1</span>], cur[N], d[N];</span><br><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> v, c; &#125; e[M &lt;&lt; <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h3 id="函数-12">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    deg[u]++, e[eid++] = &#123;v, c&#125;;</span><br><span class="line">    deg[v]++, e[eid++] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(cur, deg, <span class="keyword">sizeof</span> deg);</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> q[N];</span><br><span class="line">    d[t] = <span class="number">0</span>, q[<span class="number">0</span>] = t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> L = <span class="number">0</span>, R = <span class="number">0</span>; L &lt;= R; L++) &#123;</span><br><span class="line">        <span class="type">int</span> u = q[L];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = deg[u]; i != deg[u + <span class="number">1</span>]; i++) &#123;</span><br><span class="line">            <span class="type">int</span> k = G[i], v = e[k].v;</span><br><span class="line">            <span class="keyword">if</span> (d[v] != <span class="number">0x3f3f3f3f</span> | !e[k ^ <span class="number">1</span>].c) <span class="keyword">continue</span>;</span><br><span class="line">            d[v] = d[u] + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (v == s) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            q[++R] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == t) <span class="keyword">return</span> lim;</span><br><span class="line">    <span class="type">int</span> dis = d[u], res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>&amp; i = cur[u]; i != deg[u + <span class="number">1</span>]; i++) &#123;</span><br><span class="line">        <span class="type">int</span> k = G[i], v = e[k].v, c = e[k].c;</span><br><span class="line">        <span class="keyword">if</span> (!c | d[v] &gt;= dis) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> f = <span class="built_in">dfs</span>(v, t, <span class="built_in">min</span>(lim, c));</span><br><span class="line">        e[k].c -= f, e[k ^ <span class="number">1</span>].c += f;</span><br><span class="line">        res += f, lim -= f;</span><br><span class="line">        <span class="keyword">if</span> (!lim) <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    d[u] = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxFlow</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) deg[i + <span class="number">1</span>] += deg[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; eid; i += <span class="number">2</span>) &#123;</span><br><span class="line">        G[--deg[e[i + <span class="number">1</span>].v]] = i;</span><br><span class="line">        G[--deg[e[i].v]] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t))</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = deg[s]; i != deg[s + <span class="number">1</span>]; i++) &#123;</span><br><span class="line">            <span class="type">int</span> k = G[i], f = <span class="built_in">dfs</span>(e[k].v, t, e[k].c);</span><br><span class="line">            res += f, e[k].c -= f, e[k ^ <span class="number">1</span>].c += f;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小费用最大流-mcf">最小费用最大流 / mcf</h2>
<h3 id="原始对偶算法单路增广">原始对偶算法（单路增广）</h3>
<h4 id="定义-14">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>, M = <span class="comment">/**/</span>, SZ = <span class="comment">/**/</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> eid, deg[N], G[M &lt;&lt; <span class="number">1</span>], d[N], h[N], pre[N];</span><br><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> v, c, w; &#125; e[M &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="type">uint64_t</span> c[SZ &lt;&lt; <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h4 id="函数-13">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> c, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    deg[u]++, e[eid++] = &#123;v, c, w&#125;;</span><br><span class="line">    deg[v]++, e[eid++] = &#123;u, <span class="number">0</span>, -w&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> i, <span class="type">uint32_t</span> v0)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> v = (<span class="type">uint64_t</span>)v0 &lt;&lt; <span class="number">32</span> | i;</span><br><span class="line">    <span class="keyword">for</span> (i += SZ; i; i &gt;&gt;= <span class="number">1</span>) c[i] = <span class="built_in">min</span>(c[i], v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pop</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> v = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i += SZ; i; i &gt;&gt;= <span class="number">1</span>) c[i] = v, v = <span class="built_in">min</span>(v, c[i ^ <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dijkstra</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(c, <span class="number">-1</span>, <span class="keyword">sizeof</span> c);</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    d[s] = <span class="number">0</span>, <span class="built_in">push</span>(s, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span> (~c[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="type">int</span> u = c[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">auto</span> dis = d[u] + h[u];</span><br><span class="line">        <span class="built_in">pop</span>(u);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = deg[u]; i != deg[u + <span class="number">1</span>]; i++) &#123;</span><br><span class="line">            <span class="type">int</span> k = G[i], v = e[k].v;</span><br><span class="line">            <span class="keyword">if</span> (!e[k].c) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">auto</span> w = dis + e[k].w - h[v];</span><br><span class="line">            <span class="keyword">if</span> (w &lt; d[v]) pre[v] = k ^ <span class="number">1</span>, d[v] = w, <span class="built_in">push</span>(v, w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[t] &lt; d[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">minCostFlow</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) deg[i + <span class="number">1</span>] += deg[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; eid; i += <span class="number">2</span>) &#123;</span><br><span class="line">        G[--deg[e[i + <span class="number">1</span>].v]] = i;</span><br><span class="line">        G[--deg[e[i].v]] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> flow = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">dijkstra</span>(s, t)) &#123;</span><br><span class="line">        <span class="type">int</span> f = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u = t, k; u != s; u = e[k].v)</span><br><span class="line">            k = pre[u], f = <span class="built_in">min</span>(f, e[k ^ <span class="number">1</span>].c);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u = t, k; u != s; u = e[k].v)</span><br><span class="line">            k = pre[u], e[k ^ <span class="number">1</span>].c -= f, e[k].c += f;</span><br><span class="line">        flow += f, cost += f * h[t];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;flow, cost&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="原始对偶算法多路增广">原始对偶算法（多路增广）</h3>
<h4 id="定义-15">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="comment">/**/</span>, M = <span class="comment">/**/</span>, SZ = <span class="comment">/**/</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> eid, deg[N], G[M &lt;&lt; <span class="number">1</span>], d[N], h[N], pre[N];</span><br><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> v, c, w; &#125; e[M &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="type">uint64_t</span> c[SZ &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> deg0[N], G0[M &lt;&lt; <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h4 id="函数-14">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> c, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    deg[u]++, e[eid++] = &#123;v, c, w&#125;;</span><br><span class="line">    deg[v]++, e[eid++] = &#123;u, <span class="number">0</span>, -w&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> i, <span class="type">uint32_t</span> v0)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> v = (<span class="type">uint64_t</span>)v0 &lt;&lt; <span class="number">32</span> | i;</span><br><span class="line">    <span class="keyword">for</span> (i += SZ; i; i &gt;&gt;= <span class="number">1</span>) c[i] = <span class="built_in">min</span>(c[i], v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pop</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> v = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i += SZ; i; i &gt;&gt;= <span class="number">1</span>) c[i] = v, v = <span class="built_in">min</span>(v, c[i ^ <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dijkstra</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(c, <span class="number">-1</span>, <span class="keyword">sizeof</span> c);</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    d[s] = <span class="number">0</span>, <span class="built_in">push</span>(s, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span> (~c[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="type">int</span> u = c[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">auto</span> dis = d[u] + h[u];</span><br><span class="line">        <span class="built_in">pop</span>(u);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = deg[u]; i != deg[u + <span class="number">1</span>]; i++) &#123;</span><br><span class="line">            <span class="type">int</span> k = G[i], v = e[k].v;</span><br><span class="line">            <span class="keyword">if</span> (!e[k].c) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">auto</span> w = dis + e[k].w - h[v];</span><br><span class="line">            <span class="keyword">if</span> (w &lt; d[v]) pre[v] = k ^ <span class="number">1</span>, d[v] = w, <span class="built_in">push</span>(v, w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[t] &lt; d[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> q[N];</span><br><span class="line">    <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span> pre);</span><br><span class="line">    pre[s] = <span class="number">0</span>, q[<span class="number">0</span>] = s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>; l &lt;= r; l++) &#123;</span><br><span class="line">        <span class="type">int</span> u = q[l];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = deg0[u]; i != deg0[u + <span class="number">1</span>]; i++) &#123;</span><br><span class="line">            <span class="type">int</span> k = G0[i], v = e[k].v;</span><br><span class="line">            <span class="keyword">if</span> ((pre[v] &lt; <span class="number">0</span>) &amp; (e[k].c != <span class="number">0</span>)) &#123;</span><br><span class="line">                pre[v] = k ^ <span class="number">1</span>, q[++r] = v;</span><br><span class="line">                <span class="keyword">if</span> (v == t) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">minCostFlow</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) deg[i + <span class="number">1</span>] += deg[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; eid; i += <span class="number">2</span>) &#123;</span><br><span class="line">        G[--deg[e[i + <span class="number">1</span>].v]] = i;</span><br><span class="line">        G[--deg[e[i].v]] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> flow = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">dijkstra</span>(s, t)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) h[i] += d[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; eid; i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">int</span> u = e[i + <span class="number">1</span>].v, v = e[i].v;</span><br><span class="line">            <span class="keyword">if</span> (e[i].w == h[v] - h[u])</span><br><span class="line">                deg0[u]++, deg0[v]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) deg0[i + <span class="number">1</span>] += deg0[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; eid; i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">int</span> u = e[i + <span class="number">1</span>].v, v = e[i].v;</span><br><span class="line">            <span class="keyword">if</span> (e[i].w == h[v] - h[u])</span><br><span class="line">                G0[--deg0[u]] = i, G0[--deg0[v]] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="type">int</span> f = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> u = t, k; u != s; u = e[k].v)</span><br><span class="line">                k = pre[u], f = <span class="built_in">min</span>(f, e[k ^ <span class="number">1</span>].c);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> u = t, k; u != s; u = e[k].v)</span><br><span class="line">                k = pre[u], e[k ^ <span class="number">1</span>].c -= f, e[k].c += f;</span><br><span class="line">            flow += f, cost += f * h[t];</span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t));</span><br><span class="line">        <span class="built_in">memset</span>(deg0, <span class="number">0</span>, <span class="keyword">sizeof</span> deg0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;flow, cost&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二分图最大匹配-match">二分图最大匹配 / match</h2>
<h3 id="定义-16">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m, vis[N], mat[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[N];</span><br></pre></td></tr></table></figure>
<h3 id="函数-15">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vis[u] == s) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    vis[u] = s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : G[u]) <span class="keyword">if</span> (!mat[v] || <span class="built_in">dfs</span>(mat[v], s)) <span class="keyword">return</span> mat[v] = u, <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用">使用</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> as = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">rep</span>(i, <span class="number">1</span>, n) ans += <span class="built_in">dfs</span>(i, i);</span><br></pre></td></tr></table></figure>
<h2 id="sat-问题">2-SAT 问题</h2>
<p>求字典序最小的解，随机数据是 <span class="math inline">\(O(N+M)\)</span>，最坏复杂度 <span class="math inline">\(O(NM)\)</span>。</p>
<h3 id="定义-17">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m, co[N &lt;&lt; <span class="number">1</span>], stk[N &lt;&lt; <span class="number">1</span>], tp;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[N &lt;&lt; <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h3 id="函数-16">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> a, <span class="type">int</span> v, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    G[u * <span class="number">2</span> + !a].<span class="built_in">pb</span>(v * <span class="number">2</span> + b);</span><br><span class="line">    G[v * <span class="number">2</span> + !b].<span class="built_in">pb</span>(u * <span class="number">2</span> + a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (co[u] | co[u ^ <span class="number">1</span>]) <span class="keyword">return</span> co[u];</span><br><span class="line">    co[u] = <span class="number">1</span>, stk[++tp] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : G[u]) <span class="keyword">if</span> (!<span class="built_in">dfs</span>(v)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">twoSat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!co[i * <span class="number">2</span>] &amp;&amp; !co[i * <span class="number">2</span> + <span class="number">1</span>] &amp;&amp; !<span class="built_in">dfs</span>(i * <span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (tp) co[stk[tp--]] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">dfs</span>(i * <span class="number">2</span> + <span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        tp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="字符串">字符串</h1>
<h2 id="manacher-求偶回文串">manacher 求偶回文串</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">    <span class="type">int</span>&amp; j = R[i] = ma &gt; i ? <span class="built_in">min</span>(R[p * <span class="number">2</span> - i], ma - i) : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (s[i - j] == s[i + j + <span class="number">1</span>]) j++;</span><br><span class="line">    <span class="keyword">if</span> (i + j &gt; ma) ma = i + j, p = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="回文自动机-pam">回文自动机 PAM</h2>
<h3 id="普通版-2">普通版</h3>
<h4 id="定义-18">定义</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n, sz = <span class="number">1</span>, nw, len[N], f[N], ch[N][<span class="number">26</span>];</span><br></pre></td></tr></table></figure>
<h4 id="函数-17">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> jmp = [&amp;](<span class="type">int</span> o) &#123;</span><br><span class="line">        <span class="keyword">while</span> (s[i - len[o] - <span class="number">1</span>] != s[i]) o = f[o];</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> o = <span class="built_in">jmp</span>(nw), c = s[i] - <span class="number">97</span>;</span><br><span class="line">    <span class="keyword">if</span> (!ch[o][c]) &#123;</span><br><span class="line">        f[++sz] = ch[<span class="built_in">jmp</span>(f[o])][c];</span><br><span class="line">        len[ch[o][c] = sz] = len[o] + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    nw = ch[o][c];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="预处理">预处理</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len[<span class="number">1</span>] = <span class="number">-1</span>, f[<span class="number">0</span>] = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="偶回文版">偶回文版</h3>
<h4 id="函数-18">函数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> jmp = [&amp;](<span class="type">int</span> o) &#123;</span><br><span class="line">        <span class="keyword">while</span> (o &amp;&amp; s[i - len[o] - <span class="number">1</span>] != s[i]) o = f[o];</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> o = <span class="built_in">jmp</span>(nw), c = s[i] - <span class="number">97</span>;</span><br><span class="line">    <span class="keyword">if</span> (!ch[o][c]) &#123;</span><br><span class="line">        f[++sz] = ch[<span class="built_in">jmp</span>(f[o])][c];</span><br><span class="line">        len[ch[o][c] = sz] = len[o] + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    nw = ch[o][c];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="预处理-1">预处理</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rep</span>(i, <span class="number">0</span>, <span class="number">25</span>) ch[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h2 id="后缀数组-sa">后缀数组 / SA</h2>
<h3 id="定义-19">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, sa[N], rk[N], tp[N], px[N], buc[N];</span><br><span class="line"><span class="type">int</span> h[<span class="number">20</span>][N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br></pre></td></tr></table></figure>
<h3 id="函数-19">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">128</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) buc[rk[i] = s[i]]++;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, m) buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">per</span>(i, n, <span class="number">1</span>) sa[buc[rk[i]]--] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>, p; <span class="built_in">memset</span>(buc, p = <span class="number">0</span>, m + <span class="number">1</span> &lt;&lt; <span class="number">2</span>); k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">rep</span>(i, n - k + <span class="number">1</span>, n) p++, px[p] = rk[tp[p] = i];</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, n) <span class="keyword">if</span> (sa[i] &gt; k) p++, px[p] = rk[tp[p] = sa[i] - k];</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, n) buc[rk[i]]++;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, m) buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">per</span>(i, n, <span class="number">1</span>) sa[buc[px[i]]--] = tp[i];</span><br><span class="line">        <span class="built_in">memcpy</span>(tp, rk, n + <span class="number">1</span> &lt;&lt; <span class="number">2</span>), p = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">            <span class="type">int</span> a = sa[i], b = sa[i - <span class="number">1</span>];</span><br><span class="line">            rk[a] = p += tp[a] != tp[b] || tp[a + k] != tp[b + k];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((m = p) &gt;= n) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">height</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, n) &#123;</span><br><span class="line">        <span class="keyword">for</span> (p &amp;&amp; p--; s[i + p] == s[sa[rk[i] - <span class="number">1</span>] + p]; p++);</span><br><span class="line">        h[<span class="number">0</span>][rk[i]] = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i, <span class="number">1</span>, <span class="number">19</span>) <span class="built_in">rep</span>(j, <span class="number">1</span> &lt;&lt; i, n)</span><br><span class="line">        h[i][j] = <span class="built_in">min</span>(h[i - <span class="number">1</span>][j], h[i - <span class="number">1</span>][j - (<span class="number">1</span> &lt;&lt; i - <span class="number">1</span>)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="后缀自动机-sam">后缀自动机 / SAM</h2>
<h3 id="定义-20">定义</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n, sz = <span class="number">1</span>, nw = <span class="number">1</span>, f[N &lt;&lt; <span class="number">1</span>], len[N &lt;&lt; <span class="number">1</span>], ch[N &lt;&lt; <span class="number">1</span>][<span class="number">26</span>];</span><br></pre></td></tr></table></figure>
<h3 id="函数-20">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> u = ++sz;</span><br><span class="line">    len[u] = len[nw] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (nw &amp;&amp; !ch[nw][c]) ch[nw][c] = u, nw = f[nw];</span><br><span class="line">    <span class="keyword">if</span> (!nw) f[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> v = ch[nw][c];</span><br><span class="line">        <span class="keyword">if</span> (len[v] &gt; len[nw] + <span class="number">1</span>) &#123;</span><br><span class="line">            f[++sz] = f[v], <span class="built_in">memcpy</span>(ch[sz], ch[v], <span class="keyword">sizeof</span> ch[v]);</span><br><span class="line">            f[v] = f[u] = sz, len[sz] = len[nw] + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (ch[nw][c] == v) ch[nw][c] = sz, nw = f[nw];</span><br><span class="line">        &#125; <span class="keyword">else</span> f[u] = v;</span><br><span class="line">    &#125;</span><br><span class="line">    nw = u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小表示法-smallest-cyclic-shift">最小表示法 / smallest cyclic shift</h2>
<h3 id="函数-21">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">max</span>(&#123;i, j, k&#125;) &lt; n)</span><br><span class="line">    <span class="keyword">if</span> (s[(i + k) % n] == s[(j + k) % n]) k++;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[(i + k) % n] &gt; s[(j + k) % n]) <span class="built_in">swap</span>(i, j);</span><br><span class="line">        j += k + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (i == j) j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(i, j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小后缀-smallest-suffix">最小后缀 / smallest suffix</h2>
<h3 id="函数-22">函数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (s[j]) &#123;</span><br><span class="line">        <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (s[i + k] == s[j + k]) k++;</span><br><span class="line">        <span class="keyword">if</span> (!s[j + k]) i = <span class="built_in">max</span>(i + k, j + <span class="number">1</span>), <span class="built_in">swap</span>(i, j);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s[i + k] &gt; s[j + k]) i = <span class="built_in">max</span>(i + k, j) + <span class="number">1</span>, <span class="built_in">swap</span>(i, j);</span><br><span class="line">        <span class="keyword">else</span> j += k + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- flag of hidden posts -->
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%A8%A1%E6%9D%BF/" rel="tag"># 模板</a>
              <a href="/tags/%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/" rel="tag"># 持续更新</a>
          </div>

        

    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">platelet</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">196k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:59</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
